<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org"
      xmlns:sec="http://thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <title>[중복 확인]</title>
    <style>
        .error {
            color: red;
            font-size: 0.9em;
        }
        .valid {
            color: green;
            font-size: 0.9em;
        }
    </style>
    <script>
        $(document).ready(function() {
            // ID 선택 버튼 클릭 시
            $('#inputButton').click(function() {
                let id = $(this).data('id');
                $(opener.document).find('#memberId').val(id);
                window.close();
            });

            // 실시간 유효성 검사
            $('#searchId').on('input', function() {
                let searchId = $(this).val();
                let errorMessage = '';

                // 글자 수 검사
                if (searchId.length < 3 || searchId.length > 10) {
                    errorMessage = '아이디는 3자 이상 10자 이하로 입력해 주세요.';
                } else {
                    // 특수문자 검사
                    let regex = /[^a-zA-Z0-9]/; // 알파벳과 숫자 외의 문자
                    if (regex.test(searchId)) {
                        errorMessage = '아이디는 알파벳과 숫자만 포함할 수 있습니다.';
                    }
                }

                // 유효성 검사 결과에 따라 메시지 표시
                if (errorMessage) {
                    $('#error-message').text(errorMessage).addClass('error').removeClass('valid');
                } else {
                    $('#error-message').text('').removeClass('error').addClass('valid');
                }
            });
        });
    </script>
</head>
<body>
<h2>[ID 중복 확인]</h2>
<br>
<section>
    <form id="searchForm" action="idCheck" method="post">
        검색 할 ID <input type="text" name="searchId" id="searchId" maxlength="20">
        <input type="submit" value="검색">
    </form>

    <!-- 검색 후에만 출력 -->
    <div th:if="${searchId!=null}">
        <div th:if="${not result}">
            <p>이미 사용중인 아이디입니다.</p>
        </div>
        <div th:if="${result}">
            <p><span th:text="${searchId}"></span>
                <span>: 사용 가능한 아이디입니다.</span></p>
            <p>
                <button id="inputButton" th:data-id="${searchId}">ID 사용하기</button>
            </p>
        </div>
    </div>

    <!-- 유효성 검사 메시지 -->
    <div id="error-message"></div>
</section>
</body>
</html>
