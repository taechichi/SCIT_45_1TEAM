<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" th:href="@{/img/icon8.png}">
    <title>[ scitSainanGuide.html]</title>
        <!-- 라이브러리 CSS -->
        <link rel="stylesheet" th:href="@{/css/fontawesome/all.min.css}">
        <link rel="stylesheet" th:href="@{/css/sb-admin-2.css}">
        <!-- 커스텀 CSS -->
        <link rel="stylesheet" th:href="@{/css/topbar.css}">
        <link rel="stylesheet" th:href="@{/css/index/index.css}">
        <link rel="stylesheet" th:href="@{/css/myMarkerFavorites.css}">
</head>

<body id="page-top">
<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <div th:replace="~{fragments/menu :: menu}"></div>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- topbar -->
            <div th:replace="~{fragments/topbar :: topbar}"></div>
            <!-- End of topbar -->

            <!-- Begin Page Content -->

            <h4 class="page-title" th:text="#{my.favorite.place}">내가 즐겨찾기 한 장소</h4>

            <div>
                <!-- 현재 접속한 사람의 정보 -->
            </div>

            <div>
                <!-- 검색 폼 -->
                <div class="searchForm-container">
                    <form id="pagingForm" th:action="@{/my/myMarkerFavorites}" method="get">
                        <input type="hidden" name="page" id="page" value="1"/>
                        <input type="hidden" name="filter" id="filter" th:value="${filter}"/>
                        <input type="hidden" name="sortBy" id="sortBy" th:value="${sortBy}"/>

                        <!-- 검색어 입력 필드 -->
                        <input type="text" name="searchWord" id="searchWord" th:value="${searchWord}"
                               th:placeholder="#{my.favorite.placeholder}"/>

                        <a th:text="#{my.favorite.filter}">필터: </a>
                        <button id="filterAll" th:text="#{my.favorite.view.all}">모두 보기</button>
                        <button id="filterHospital" th:text="#{my.favorite.hospital}">병원</button>
                        <button id="filterShelter" th:text="#{my.favorite.shelter}">대피소</button>
                        <a th:text="#{my.favorite.array}">/ 정렬: </a>
                        <button id="sortByDistance" th:text="#{my.favorite.distance}">거리순</button>
                        <button id="sortByName" th:text="#{my.favorite.name}">이름순</button>
                        <!--<input type="submit" onclick="pagingFormSubmit(1)" value="검색"/>-->
                    </form>
                </div>

                <!-- 즐겨찾기 데이터 표시하는 공간 전체를 form으로 감싸 삭제할 수 있도록 함 -->
                <form th:action="@{/my/myMarkerFavorites/delete}" method="post" id="deleteForm">
                        <button type="submit" class="unfavorite-button" th:text="#{my.favorite.delete}">즐겨찾기 삭제</button>

                    <!-- 삭제 성공 실패 출력하는 공간 -->
                    <div id="error-message" th:if="${errorMessage}" >
                        <p th:text="${errorMessage}"></p>
                    </div>

                    <div id="success-message" th:if="${successMessage}" >
                        <p th:text="${successMessage}"></p>
                    </div>
                    <!-- 삭제 성공 실패 출력하는 공간 -->

                    <!-- 즐겨찾기 마커 데이터 출력하는 공간 -->
                    <table id="marker-favorite-table" >
                        <colgroup>
                            <col class="col-select">
                            <col class="col-name">
                            <col class="col-type">
                        </colgroup>
                        <thead>
                        <tr>
                            <th th:text="#{my.favorite.marker}">즐겨찾기</th>
                            <th th:text="#{my.favorite.nameof}">이름</th>
                            <th th:text="#{my.favorite.hors}">병원/대피소</th>
                        </tr>
                        </thead>
                        <tbody id="markerTableBody">
                        <tr th:each="marker : ${pageData.content}">
                            <td> <input type="checkbox" name="favoriteId" th:value="${marker.favoriteId}"></td>
                            <td>
            <span th:if="${marker.nickname != null and !marker.nickname.isEmpty()}">
                <a th:text="${marker.nickname}" class="nickname-exists"></a>
                <a>(</a>
                <a th:text="${marker.name}"></a>
                <a>)</a>
            </span>
                                <span th:if="${marker.nickname == null or marker.nickname.isEmpty()}">
                <a th:text="${marker.name}" class="nickname-missing"></a>
            </span>
                            </td>
                            <td>
                                <span th:if="${marker.hospitalId != null}" th:text="#{my.favorite.hospital}">병원</span>
                                <span th:if="${marker.hospitalId == null}" th:text="#{my.favorite.shelter}">대피소</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
        </form>
                <!-- pagination 부분 -->
                <div th:replace="~{fragments/pagination :: pagination}"></div>
            </div>
        </div>
        <!-- End of Main Content -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- JavaScript 내 Thymeleaf(HTML에서만 정상 동작) 표현식은 서버에서 렌더링된 후 클라이언트로 전달되어야 함
      동적으로 추가되는 요소에 대해 JS로 국제화 th:text를 추가하기 위해서는, 반드시 th:inline="javascript"
      형식을 사용해야 Thymeleaf 구문이 JavaScript 내부에서 정상적으로 해석되고, JS 내에서 타임리프 사용 가능
      서버에서 Thymeleaf 표현식을 처리한 후, 그 값을 JavaScript 변수로 전달! JS에서는 ${변수} 형태로 사용 -->
<script th:inline="javascript">
    <!-- 상태용변수 -->
    let expiredMessage = /*[[#{main.myStatus.expiredTime}]]*/ '만료된 기본 메시지';
    let remainingMessage = /*[[#{main.myStatus.time.remaining}]]*/ '남은 시간:';
    let hoursLabel = /*[[#{main.myStatus.time.hoursLeft}]]*/ '시간';
    let minutesLabel = /*[[#{main.myStatus.time.minutesLeft}]]*/ '분';
    let secondsLabel = /*[[#{main.myStatus.time.secondsLeft}]]*/ '초';
    <!-- 경로표시용 변수 -->
    let walkingRoot = /*[[#{map.walkingRoot}]]*/ '도보 경로 정보';
    let bicycleRoot = /*[[#{map.bicycleRoot}]]*/ '도보 경로 정보';
    let distanceLabel = /*[[#{map.distance}]]*/ '거리:';
    let durationLabel = /*[[#{map.duration}]]*/ '소요 시간:';
</script>

<div th:replace="~{fragments/logoutModal :: logoutModel}"></div>

<!-- 페이징 기능을 위한 js -->
<script th:src="@{/vendor/jquery/jquery.min.js}"></script>

<!-- Bootstrap JavaScript 로딩 -->
<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

<!-- jQuery Easing Plugin 로딩 -->
<script th:src="@{/vendor/jquery-easing/jquery.easing.min.js}"></script>

<!-- sb-admin-2.js 로딩 -->
<script th:src="@{/js/sb-admin-2.js}"></script>

<!-- topbar.js 로딩 -->
<script th:src="@{/js/main/topbar.js}"></script>

<!-- 기타 스크립트 로딩 -->
<script th:src="@{/js/paging.js}"></script>
<script th:src="@{/js/myPage/myMarkerFavorites.js}"></script>
</body>
</html>